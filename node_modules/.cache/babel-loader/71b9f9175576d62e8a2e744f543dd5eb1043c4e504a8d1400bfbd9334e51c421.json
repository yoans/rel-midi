{"ast":null,"code":"import React,{useState,useEffect,useCallback}from'react';import{useSynth}from'./SynthEngine';import Keyboard from'./components/Keyboard';import Controls from'./components/Controls';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";function MidiController(){const{playNote,stopNote,settings,updateSetting}=useSynth();const[midiOutputs,setMidiOutputs]=useState([]);const[selectedOutput,setSelectedOutput]=useState(null);const[activeNotes,setActiveNotes]=useState([]);// MIDI Access Initialization\nuseEffect(()=>{const getMIDIAccess=async()=>{try{const access=await navigator.requestMIDIAccess();const outputs=Array.from(access.outputs.values());setMidiOutputs(outputs);if(outputs.length>0){setSelectedOutput(outputs[0].id);}}catch(err){console.warn('MIDI access not available:',err);}};getMIDIAccess();},[]);// Handle Note On\nconst handleNoteOn=useCallback(note=>{if(!activeNotes.includes(note)){setActiveNotes(prev=>[...prev,note]);// Play internal synth\nplayNote(note);// Send MIDI if output selected\nif(selectedOutput){navigator.requestMIDIAccess().then(access=>{const output=access.outputs.get(selectedOutput);if(output){output.send([0x90,note,100]);}});}}},[activeNotes,playNote,selectedOutput]);// Handle Note Off\nconst handleNoteOff=useCallback(note=>{setActiveNotes(prev=>prev.filter(n=>n!==note));// Stop internal synth\nstopNote(note);// Send MIDI off\nif(selectedOutput){navigator.requestMIDIAccess().then(access=>{const output=access.outputs.get(selectedOutput);if(output){output.send([0x80,note,0]);}});}},[stopNote,selectedOutput]);// Keyboard Support\nuseEffect(()=>{const keyMap={'a':60,'w':61,'s':62,'e':63,'d':64,'f':65,'t':66,'g':67,'y':68,'h':69,'u':70,'j':71,'k':72,'o':73,'l':74,'p':75,';':76,\"'\":77};const handleKeyDown=e=>{if(e.repeat)return;const note=keyMap[e.key.toLowerCase()];if(note)handleNoteOn(note);};const handleKeyUp=e=>{const note=keyMap[e.key.toLowerCase()];if(note)handleNoteOff(note);};window.addEventListener('keydown',handleKeyDown);window.addEventListener('keyup',handleKeyUp);return()=>{window.removeEventListener('keydown',handleKeyDown);window.removeEventListener('keyup',handleKeyUp);};},[handleNoteOn,handleNoteOff]);return/*#__PURE__*/_jsxs(\"div\",{className:\"synth-container\",children:[/*#__PURE__*/_jsx(\"h1\",{children:\"Neon Synth\"}),/*#__PURE__*/_jsx(Controls,{settings:settings,updateSetting:updateSetting,midiOutputs:midiOutputs,selectedOutput:selectedOutput,setSelectedOutput:setSelectedOutput}),/*#__PURE__*/_jsx(Keyboard,{activeNotes:activeNotes,onNoteOn:handleNoteOn,onNoteOff:handleNoteOff})]});}export default MidiController;","map":{"version":3,"names":["React","useState","useEffect","useCallback","useSynth","Keyboard","Controls","jsx","_jsx","jsxs","_jsxs","MidiController","playNote","stopNote","settings","updateSetting","midiOutputs","setMidiOutputs","selectedOutput","setSelectedOutput","activeNotes","setActiveNotes","getMIDIAccess","access","navigator","requestMIDIAccess","outputs","Array","from","values","length","id","err","console","warn","handleNoteOn","note","includes","prev","then","output","get","send","handleNoteOff","filter","n","keyMap","handleKeyDown","e","repeat","key","toLowerCase","handleKeyUp","window","addEventListener","removeEventListener","className","children","onNoteOn","onNoteOff"],"sources":["C:/bench/rel-midi/src/MidiController.js"],"sourcesContent":["import React, { useState, useEffect, useCallback } from 'react';\r\nimport { useSynth } from './SynthEngine';\r\nimport Keyboard from './components/Keyboard';\r\nimport Controls from './components/Controls';\r\n\r\nfunction MidiController() {\r\n  const { playNote, stopNote, settings, updateSetting } = useSynth();\r\n  const [midiOutputs, setMidiOutputs] = useState([]);\r\n  const [selectedOutput, setSelectedOutput] = useState(null);\r\n  const [activeNotes, setActiveNotes] = useState([]);\r\n\r\n  // MIDI Access Initialization\r\n  useEffect(() => {\r\n    const getMIDIAccess = async () => {\r\n      try {\r\n        const access = await navigator.requestMIDIAccess();\r\n        const outputs = Array.from(access.outputs.values());\r\n        setMidiOutputs(outputs);\r\n        if (outputs.length > 0) {\r\n          setSelectedOutput(outputs[0].id);\r\n        }\r\n      } catch (err) {\r\n        console.warn('MIDI access not available:', err);\r\n      }\r\n    };\r\n    getMIDIAccess();\r\n  }, []);\r\n\r\n  // Handle Note On\r\n  const handleNoteOn = useCallback((note) => {\r\n    if (!activeNotes.includes(note)) {\r\n      setActiveNotes(prev => [...prev, note]);\r\n\r\n      // Play internal synth\r\n      playNote(note);\r\n\r\n      // Send MIDI if output selected\r\n      if (selectedOutput) {\r\n        navigator.requestMIDIAccess().then(access => {\r\n          const output = access.outputs.get(selectedOutput);\r\n          if (output) {\r\n            output.send([0x90, note, 100]);\r\n          }\r\n        });\r\n      }\r\n    }\r\n  }, [activeNotes, playNote, selectedOutput]);\r\n\r\n  // Handle Note Off\r\n  const handleNoteOff = useCallback((note) => {\r\n    setActiveNotes(prev => prev.filter(n => n !== note));\r\n\r\n    // Stop internal synth\r\n    stopNote(note);\r\n\r\n    // Send MIDI off\r\n    if (selectedOutput) {\r\n      navigator.requestMIDIAccess().then(access => {\r\n        const output = access.outputs.get(selectedOutput);\r\n        if (output) {\r\n          output.send([0x80, note, 0]);\r\n        }\r\n      });\r\n    }\r\n  }, [stopNote, selectedOutput]);\r\n\r\n  // Keyboard Support\r\n  useEffect(() => {\r\n    const keyMap = {\r\n      'a': 60, 'w': 61, 's': 62, 'e': 63, 'd': 64, 'f': 65, 't': 66,\r\n      'g': 67, 'y': 68, 'h': 69, 'u': 70, 'j': 71, 'k': 72, 'o': 73,\r\n      'l': 74, 'p': 75, ';': 76, \"'\": 77\r\n    };\r\n\r\n    const handleKeyDown = (e) => {\r\n      if (e.repeat) return;\r\n      const note = keyMap[e.key.toLowerCase()];\r\n      if (note) handleNoteOn(note);\r\n    };\r\n\r\n    const handleKeyUp = (e) => {\r\n      const note = keyMap[e.key.toLowerCase()];\r\n      if (note) handleNoteOff(note);\r\n    };\r\n\r\n    window.addEventListener('keydown', handleKeyDown);\r\n    window.addEventListener('keyup', handleKeyUp);\r\n\r\n    return () => {\r\n      window.removeEventListener('keydown', handleKeyDown);\r\n      window.removeEventListener('keyup', handleKeyUp);\r\n    };\r\n  }, [handleNoteOn, handleNoteOff]);\r\n\r\n  return (\r\n    <div className=\"synth-container\">\r\n      <h1>Neon Synth</h1>\r\n\r\n      <Controls\r\n        settings={settings}\r\n        updateSetting={updateSetting}\r\n        midiOutputs={midiOutputs}\r\n        selectedOutput={selectedOutput}\r\n        setSelectedOutput={setSelectedOutput}\r\n      />\r\n\r\n      <Keyboard\r\n        activeNotes={activeNotes}\r\n        onNoteOn={handleNoteOn}\r\n        onNoteOff={handleNoteOff}\r\n      />\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default MidiController;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}