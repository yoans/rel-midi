{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useEffect, useRef, useState, useCallback } from 'react';\nexport const useSynth = () => {\n  _s();\n  const audioContext = useRef(null);\n  const masterGain = useRef(null);\n  const filterNode = useRef(null);\n  const activeOscillators = useRef({});\n  const [settings, setSettings] = useState({\n    waveform: 'sawtooth',\n    attack: 0.01,\n    decay: 0.1,\n    sustain: 0.5,\n    release: 0.3,\n    cutoff: 2000,\n    resonance: 1,\n    masterVolume: 0.5\n  });\n  useEffect(() => {\n    // Initialize Audio Context\n    const AudioContext = window.AudioContext || window.webkitAudioContext;\n    audioContext.current = new AudioContext();\n\n    // Master Gain\n    masterGain.current = audioContext.current.createGain();\n    masterGain.current.gain.value = settings.masterVolume;\n\n    // Filter\n    filterNode.current = audioContext.current.createBiquadFilter();\n    filterNode.current.type = 'lowpass';\n    filterNode.current.frequency.value = settings.cutoff;\n    filterNode.current.Q.value = settings.resonance;\n\n    // Connect graph\n    filterNode.current.connect(masterGain.current);\n    masterGain.current.connect(audioContext.current.destination);\n    return () => {\n      if (audioContext.current) {\n        audioContext.current.close();\n      }\n    };\n  }, []);\n  useEffect(() => {\n    if (masterGain.current) {\n      masterGain.current.gain.setTargetAtTime(settings.masterVolume, audioContext.current.currentTime, 0.01);\n    }\n    if (filterNode.current) {\n      filterNode.current.frequency.setTargetAtTime(settings.cutoff, audioContext.current.currentTime, 0.01);\n      filterNode.current.Q.setTargetAtTime(settings.resonance, audioContext.current.currentTime, 0.01);\n    }\n  }, [settings.masterVolume, settings.cutoff, settings.resonance]);\n  const playNote = useCallback((note, velocity = 127) => {\n    if (!audioContext.current) return;\n\n    // Resume context if suspended (browser policy)\n    if (audioContext.current.state === 'suspended') {\n      audioContext.current.resume();\n    }\n    const freq = 440 * Math.pow(2, (note - 69) / 12);\n    const now = audioContext.current.currentTime;\n    const vel = velocity / 127;\n    const osc = audioContext.current.createOscillator();\n    const gain = audioContext.current.createGain();\n    osc.type = settings.waveform;\n    osc.frequency.setValueAtTime(freq, now);\n\n    // Envelope\n    gain.gain.setValueAtTime(0, now);\n    gain.gain.linearRampToValueAtTime(vel, now + settings.attack);\n    gain.gain.linearRampToValueAtTime(vel * settings.sustain, now + settings.attack + settings.decay);\n    osc.connect(gain);\n    gain.connect(filterNode.current);\n    osc.start(now);\n\n    // Store reference to stop later\n    if (activeOscillators.current[note]) {\n      // If note is already playing, stop it first to avoid stuck notes or layering\n      stopNote(note);\n    }\n    activeOscillators.current[note] = {\n      osc,\n      gain\n    };\n  }, [settings]);\n  const stopNote = useCallback(note => {\n    if (!audioContext.current || !activeOscillators.current[note]) return;\n    const {\n      osc,\n      gain\n    } = activeOscillators.current[note];\n    const now = audioContext.current.currentTime;\n\n    // Release phase\n    gain.gain.cancelScheduledValues(now);\n    gain.gain.setValueAtTime(gain.gain.value, now);\n    gain.gain.exponentialRampToValueAtTime(0.001, now + settings.release);\n    osc.stop(now + settings.release + 0.1); // Stop slightly after release to ensure silence\n\n    // Cleanup\n    setTimeout(() => {\n      // disconnect nodes to free memory\n      osc.disconnect();\n      gain.disconnect();\n    }, (settings.release + 0.2) * 1000);\n    delete activeOscillators.current[note];\n  }, [settings]);\n  const updateSetting = (key, value) => {\n    setSettings(prev => ({\n      ...prev,\n      [key]: value\n    }));\n  };\n  return {\n    playNote,\n    stopNote,\n    settings,\n    updateSetting\n  };\n};\n_s(useSynth, \"S3Fa37dKXtb0Tk6y3sVYtUL9G8Y=\");","map":{"version":3,"names":["useEffect","useRef","useState","useCallback","useSynth","_s","audioContext","masterGain","filterNode","activeOscillators","settings","setSettings","waveform","attack","decay","sustain","release","cutoff","resonance","masterVolume","AudioContext","window","webkitAudioContext","current","createGain","gain","value","createBiquadFilter","type","frequency","Q","connect","destination","close","setTargetAtTime","currentTime","playNote","note","velocity","state","resume","freq","Math","pow","now","vel","osc","createOscillator","setValueAtTime","linearRampToValueAtTime","start","stopNote","cancelScheduledValues","exponentialRampToValueAtTime","stop","setTimeout","disconnect","updateSetting","key","prev"],"sources":["C:/bench/rel-midi/src/SynthEngine.js"],"sourcesContent":["import { useEffect, useRef, useState, useCallback } from 'react';\r\n\r\nexport const useSynth = () => {\r\n  const audioContext = useRef(null);\r\n  const masterGain = useRef(null);\r\n  const filterNode = useRef(null);\r\n  const activeOscillators = useRef({});\r\n\r\n  const [settings, setSettings] = useState({\r\n    waveform: 'sawtooth',\r\n    attack: 0.01,\r\n    decay: 0.1,\r\n    sustain: 0.5,\r\n    release: 0.3,\r\n    cutoff: 2000,\r\n    resonance: 1,\r\n    masterVolume: 0.5\r\n  });\r\n\r\n  useEffect(() => {\r\n    // Initialize Audio Context\r\n    const AudioContext = window.AudioContext || window.webkitAudioContext;\r\n    audioContext.current = new AudioContext();\r\n    \r\n    // Master Gain\r\n    masterGain.current = audioContext.current.createGain();\r\n    masterGain.current.gain.value = settings.masterVolume;\r\n    \r\n    // Filter\r\n    filterNode.current = audioContext.current.createBiquadFilter();\r\n    filterNode.current.type = 'lowpass';\r\n    filterNode.current.frequency.value = settings.cutoff;\r\n    filterNode.current.Q.value = settings.resonance;\r\n\r\n    // Connect graph\r\n    filterNode.current.connect(masterGain.current);\r\n    masterGain.current.connect(audioContext.current.destination);\r\n\r\n    return () => {\r\n      if (audioContext.current) {\r\n        audioContext.current.close();\r\n      }\r\n    };\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (masterGain.current) {\r\n      masterGain.current.gain.setTargetAtTime(settings.masterVolume, audioContext.current.currentTime, 0.01);\r\n    }\r\n    if (filterNode.current) {\r\n      filterNode.current.frequency.setTargetAtTime(settings.cutoff, audioContext.current.currentTime, 0.01);\r\n      filterNode.current.Q.setTargetAtTime(settings.resonance, audioContext.current.currentTime, 0.01);\r\n    }\r\n  }, [settings.masterVolume, settings.cutoff, settings.resonance]);\r\n\r\n  const playNote = useCallback((note, velocity = 127) => {\r\n    if (!audioContext.current) return;\r\n    \r\n    // Resume context if suspended (browser policy)\r\n    if (audioContext.current.state === 'suspended') {\r\n      audioContext.current.resume();\r\n    }\r\n\r\n    const freq = 440 * Math.pow(2, (note - 69) / 12);\r\n    const now = audioContext.current.currentTime;\r\n    const vel = velocity / 127;\r\n\r\n    const osc = audioContext.current.createOscillator();\r\n    const gain = audioContext.current.createGain();\r\n\r\n    osc.type = settings.waveform;\r\n    osc.frequency.setValueAtTime(freq, now);\r\n\r\n    // Envelope\r\n    gain.gain.setValueAtTime(0, now);\r\n    gain.gain.linearRampToValueAtTime(vel, now + settings.attack);\r\n    gain.gain.linearRampToValueAtTime(vel * settings.sustain, now + settings.attack + settings.decay);\r\n\r\n    osc.connect(gain);\r\n    gain.connect(filterNode.current);\r\n\r\n    osc.start(now);\r\n\r\n    // Store reference to stop later\r\n    if (activeOscillators.current[note]) {\r\n        // If note is already playing, stop it first to avoid stuck notes or layering\r\n        stopNote(note);\r\n    }\r\n    activeOscillators.current[note] = { osc, gain };\r\n  }, [settings]);\r\n\r\n  const stopNote = useCallback((note) => {\r\n    if (!audioContext.current || !activeOscillators.current[note]) return;\r\n\r\n    const { osc, gain } = activeOscillators.current[note];\r\n    const now = audioContext.current.currentTime;\r\n\r\n    // Release phase\r\n    gain.gain.cancelScheduledValues(now);\r\n    gain.gain.setValueAtTime(gain.gain.value, now);\r\n    gain.gain.exponentialRampToValueAtTime(0.001, now + settings.release);\r\n\r\n    osc.stop(now + settings.release + 0.1); // Stop slightly after release to ensure silence\r\n    \r\n    // Cleanup\r\n    setTimeout(() => {\r\n        // disconnect nodes to free memory\r\n        osc.disconnect();\r\n        gain.disconnect();\r\n    }, (settings.release + 0.2) * 1000);\r\n\r\n    delete activeOscillators.current[note];\r\n  }, [settings]);\r\n\r\n  const updateSetting = (key, value) => {\r\n    setSettings(prev => ({ ...prev, [key]: value }));\r\n  };\r\n\r\n  return {\r\n    playNote,\r\n    stopNote,\r\n    settings,\r\n    updateSetting\r\n  };\r\n};\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}