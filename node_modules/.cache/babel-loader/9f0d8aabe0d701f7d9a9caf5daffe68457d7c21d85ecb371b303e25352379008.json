{"ast":null,"code":"import React,{useEffect,useRef}from'react';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const NOTE_NAMES=['C','C♯','D','D♯','E','F','F♯','G','G♯','A','A♯','B'];const getNoteName=midi=>`${NOTE_NAMES[midi%12]}${Math.floor(midi/12)-1}`;const isBlackKey=note=>{const n=note%12;return n===1||n===3||n===6||n===8||n===10;};const KEY_INTERVALS={'A':-4,'S':-3,'D':-2,'F':-1,'⎵':0,'J':1,'K':2,'L':3,';':4};const Keyboard=_ref=>{let{activeNotes,onNoteOn,onNoteOff,currentNote}=_ref;const startNote=36;// C2\nconst endNote=96;// C7\nconst containerRef=useRef(null);const currentKeyRef=useRef(null);// Auto-scroll to keep current note centered\nuseEffect(()=>{if(currentKeyRef.current&&containerRef.current){const container=containerRef.current;const key=currentKeyRef.current;const containerRect=container.getBoundingClientRect();const keyRect=key.getBoundingClientRect();const keyCenter=keyRect.left+keyRect.width/2-containerRect.left+container.scrollLeft;const scrollTarget=keyCenter-containerRect.width/2;container.scrollTo({left:scrollTarget,behavior:'smooth'});}},[currentNote]);// Build overlay map: note → [{label, interval}]\nconst overlayMap={};if(currentNote!==undefined){Object.entries(KEY_INTERVALS).forEach(_ref2=>{let[label,interval]=_ref2;const target=currentNote+interval;if(target>=startNote&&target<=endNote){if(!overlayMap[target])overlayMap[target]=[];overlayMap[target].push({label,interval});}});}const keys=[];for(let i=startNote;i<=endNote;i++){keys.push({note:i,isBlack:isBlackKey(i),noteName:getNoteName(i),isC:i%12===0,overlays:overlayMap[i]||[],isCurrent:i===currentNote,isActive:activeNotes.includes(i)});}return/*#__PURE__*/_jsx(\"div\",{className:\"keyboard-wrapper\",children:/*#__PURE__*/_jsx(\"div\",{className:\"keyboard-container\",ref:containerRef,children:/*#__PURE__*/_jsx(\"div\",{className:\"keyboard\",children:keys.map(key=>/*#__PURE__*/_jsxs(\"div\",{ref:key.isCurrent?currentKeyRef:null,className:['key',key.isBlack?'black-key':'white-key',key.isActive?'active':'',key.isCurrent?'anchor':'',key.overlays.length>0?'has-overlay':''].filter(Boolean).join(' '),onMouseDown:()=>onNoteOn(key.note),onMouseUp:()=>onNoteOff(key.note),onMouseLeave:()=>key.isActive&&onNoteOff(key.note),onTouchStart:e=>{e.preventDefault();onNoteOn(key.note);},onTouchEnd:e=>{e.preventDefault();onNoteOff(key.note);},children:[key.overlays.length>0&&/*#__PURE__*/_jsx(\"div\",{className:\"key-overlays\",children:key.overlays.map(_ref3=>{let{label,interval}=_ref3;return/*#__PURE__*/_jsx(\"span\",{className:`overlay-badge ${interval<0?'neg':interval>0?'pos':'zero'}`,children:label},label);})}),key.isCurrent&&/*#__PURE__*/_jsx(\"div\",{className:\"anchor-marker\"}),key.isC&&/*#__PURE__*/_jsx(\"span\",{className:\"note-label\",children:key.noteName})]},key.note))})})});};export default Keyboard;","map":{"version":3,"names":["React","useEffect","useRef","jsx","_jsx","jsxs","_jsxs","NOTE_NAMES","getNoteName","midi","Math","floor","isBlackKey","note","n","KEY_INTERVALS","Keyboard","_ref","activeNotes","onNoteOn","onNoteOff","currentNote","startNote","endNote","containerRef","currentKeyRef","current","container","key","containerRect","getBoundingClientRect","keyRect","keyCenter","left","width","scrollLeft","scrollTarget","scrollTo","behavior","overlayMap","undefined","Object","entries","forEach","_ref2","label","interval","target","push","keys","i","isBlack","noteName","isC","overlays","isCurrent","isActive","includes","className","children","ref","map","length","filter","Boolean","join","onMouseDown","onMouseUp","onMouseLeave","onTouchStart","e","preventDefault","onTouchEnd","_ref3"],"sources":["C:/bench/rel-midi/src/components/Keyboard.js"],"sourcesContent":["import React, { useEffect, useRef } from 'react';\r\n\r\nconst NOTE_NAMES = ['C', 'C♯', 'D', 'D♯', 'E', 'F', 'F♯', 'G', 'G♯', 'A', 'A♯', 'B'];\r\nconst getNoteName = (midi) => `${NOTE_NAMES[midi % 12]}${Math.floor(midi / 12) - 1}`;\r\n\r\nconst isBlackKey = (note) => {\r\n    const n = note % 12;\r\n    return n === 1 || n === 3 || n === 6 || n === 8 || n === 10;\r\n};\r\n\r\nconst KEY_INTERVALS = {\r\n    'A': -4, 'S': -3, 'D': -2, 'F': -1,\r\n    '⎵': 0,\r\n    'J': 1, 'K': 2, 'L': 3, ';': 4,\r\n};\r\n\r\nconst Keyboard = ({ activeNotes, onNoteOn, onNoteOff, currentNote }) => {\r\n    const startNote = 36; // C2\r\n    const endNote = 96;   // C7\r\n    const containerRef = useRef(null);\r\n    const currentKeyRef = useRef(null);\r\n\r\n    // Auto-scroll to keep current note centered\r\n    useEffect(() => {\r\n        if (currentKeyRef.current && containerRef.current) {\r\n            const container = containerRef.current;\r\n            const key = currentKeyRef.current;\r\n            const containerRect = container.getBoundingClientRect();\r\n            const keyRect = key.getBoundingClientRect();\r\n\r\n            const keyCenter = keyRect.left + keyRect.width / 2 - containerRect.left + container.scrollLeft;\r\n            const scrollTarget = keyCenter - containerRect.width / 2;\r\n\r\n            container.scrollTo({ left: scrollTarget, behavior: 'smooth' });\r\n        }\r\n    }, [currentNote]);\r\n\r\n    // Build overlay map: note → [{label, interval}]\r\n    const overlayMap = {};\r\n    if (currentNote !== undefined) {\r\n        Object.entries(KEY_INTERVALS).forEach(([label, interval]) => {\r\n            const target = currentNote + interval;\r\n            if (target >= startNote && target <= endNote) {\r\n                if (!overlayMap[target]) overlayMap[target] = [];\r\n                overlayMap[target].push({ label, interval });\r\n            }\r\n        });\r\n    }\r\n\r\n    const keys = [];\r\n    for (let i = startNote; i <= endNote; i++) {\r\n        keys.push({\r\n            note: i,\r\n            isBlack: isBlackKey(i),\r\n            noteName: getNoteName(i),\r\n            isC: i % 12 === 0,\r\n            overlays: overlayMap[i] || [],\r\n            isCurrent: i === currentNote,\r\n            isActive: activeNotes.includes(i),\r\n        });\r\n    }\r\n\r\n    return (\r\n        <div className=\"keyboard-wrapper\">\r\n            <div className=\"keyboard-container\" ref={containerRef}>\r\n                <div className=\"keyboard\">\r\n                    {keys.map((key) => (\r\n                        <div\r\n                            key={key.note}\r\n                            ref={key.isCurrent ? currentKeyRef : null}\r\n                            className={[\r\n                                'key',\r\n                                key.isBlack ? 'black-key' : 'white-key',\r\n                                key.isActive ? 'active' : '',\r\n                                key.isCurrent ? 'anchor' : '',\r\n                                key.overlays.length > 0 ? 'has-overlay' : '',\r\n                            ].filter(Boolean).join(' ')}\r\n                            onMouseDown={() => onNoteOn(key.note)}\r\n                            onMouseUp={() => onNoteOff(key.note)}\r\n                            onMouseLeave={() => key.isActive && onNoteOff(key.note)}\r\n                            onTouchStart={(e) => { e.preventDefault(); onNoteOn(key.note); }}\r\n                            onTouchEnd={(e) => { e.preventDefault(); onNoteOff(key.note); }}\r\n                        >\r\n                            {key.overlays.length > 0 && (\r\n                                <div className=\"key-overlays\">\r\n                                    {key.overlays.map(({ label, interval }) => (\r\n                                        <span\r\n                                            key={label}\r\n                                            className={`overlay-badge ${interval < 0 ? 'neg' : interval > 0 ? 'pos' : 'zero'}`}\r\n                                        >\r\n                                            {label}\r\n                                        </span>\r\n                                    ))}\r\n                                </div>\r\n                            )}\r\n                            {key.isCurrent && <div className=\"anchor-marker\" />}\r\n                            {key.isC && <span className=\"note-label\">{key.noteName}</span>}\r\n                        </div>\r\n                    ))}\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default Keyboard;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}